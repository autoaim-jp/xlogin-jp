<html lang="ja"><meta charset="utf-8"><meta name="viewport"content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>confirm | xlogin.jp</title><meta name="author"content="autoaim_jp"><meta name="description"content="confirm permission"><link href="https://fonts.googleapis.com/css?family=Material+Icons+Outlined"rel="stylesheet"><link rel="apple-touch-icon"sizes="180x180"href="/img/logo/apple-touch-icon.webp"><link rel="icon"type="image/webp"sizes="32x32"href="/img/logo/favicon-32x32.webp"><link rel="icon"type="image/webp"sizes="16x16"href="/img/logo/favicon-16x16.webp"><link rel="mask-icon"href="/img/logo/safari-pinned-tab.svg"color="#5bbad5"><link rel="shortcut icon"href="/img/logo/favicon.ico"><meta name="msapplication-TileColor"content="#ffffff"><meta name="theme-color"content="#ffffff"><link href="/css/tailwind.css"rel="stylesheet"><body class="flex flex-col"><nav class="w-full z-30 top-0 py-1"><div class="max-w-3xl container mx-auto flex flex-wrap items-center justify-between mt-0 px-2 py-2"><div class="pl-4 flex items-center"><a class="font-bold text-2xl"href="/"><img class="inline-block align-bottom"src="/img/logo.webp"width="48px"height="48px"><div class="inline-block ml-2"><span>xlogin.jp</span><br><span class="text-sm">simple login service</span></div></a></div><div class="pl-4 flex items-center z-40"><div class="block xl:hidden pr-4"><button id="commonNavToggle"class="flex items-center px-3 py-2 rounded text-gray-500 hover:text-gray-800 appearance-none bg-white focus:outline-none"><svg viewBox="0 0 100 80"width="40"height="70"><rect width="100"height="20"></rect><rect y="30"width="100"height="20"></rect><rect y="60"width="100"height="20"></rect><text x="50%"y="90"text-anchor="middle"dominant-baseline="central"font-family="Meiryo"font-size="30">Menu</text></svg></button></div></div><div class="xl:relative absolute w-full left-0 xl:top-auto top-24 flex items-center grid xl:w-auto"><div class="xl:flex xl:items-center xl:w-auto xl:block mt-2 xl:mt-0 p-1 xl:p-0 z-20 bg-gray-100 border-2 xl:bg-transparent xl:border-0 rounded hidden"id="commonNavContent"><ul class="lg:flex justify-end flex-1 xl:flex-row flex-col items-center text-center text-xl"><li class="xl:m-0 mr-3 mt-2 w-full border-b-2 border-white"><a data-id="notificationBtn"class="inline-block py-2 px-4 font-bold no-underline"href="#">Notification</a><li class="xl:m-0 mr-3 mt-2 w-full border-b-2 border-white"><a class="inline-block py-2 px-4 font-bold no-underline"href="/logout">Logout</a><li class="xl:m-0 mr-3 mt-2 w-full border-b-2 border-white"><a class="inline-block py-2 px-4 font-bold no-underline"href="/serviceList"target="_blank">Service</a><li class="xl:m-0 mr-3 mt-2 w-full border-b-2 border-white"><a class="inline-block py-2 px-4 font-bold no-underline"href="https://github.com/autoaim-jp/xlogin-jp"target="_blank">GitHub</a></ul></div></div></div></nav><div id="notificationContainer"class="z-50 mt-20 p-4 absolute right-0 top-0 flex-col"></div><a id="notificationTemplate"data-id="notification"class="flex flex-col block bg-white max-w-md rounded-lg p-6 shadow mb-4 w-80 hidden"href="#"><p data-id="subject"class="text-xl text-slate-700 font-medium">Login at 2022/01/01 00:00:00<div class="flex justify-end"><div class="text-sm inline-flex space-x-1 items-center"><span>show detail</span> <svg class="w-3 h-3"fill="none"stroke="currentColor"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"stroke-linejoin="round"stroke-width="2"d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></div></a><div class="section1 min-h-80 flex flex-col text-black md:flex items-center justify-center flex-grow p-2"><div class="max-w-lg bg-gray-100 p-6 rounded shadow-xl max-w-4xl w-full"><ul class="inline-flex space-x-1 md:space-x-3"><li class="inline-flex items-center"><a href="/"class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><svg class="w-4 h-4 mr-2"fill="currentColor"viewBox="0 0 20 20"xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> ホーム</a><li class="inline-flex items-center"><a href="/confirm"class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><svg class="w-6 h-6 text-gray-400"fill="currentColor"viewBox="0 0 20 20"xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd"d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"clip-rule="evenodd"></path></svg> 権限の確認</a></ul></div></div><div class="section1 min-h-80 flex flex-col text-center text-black md:flex items-center justify-center flex-grow p-2"><div class="max-w-lg bg-gray-100 p-6 rounded shadow-xl max-w-4xl w-full"><div id="memoContentWrap"class="w-full"></div><div class="block mx-auto p-6 rounded-lg shadow-lg bg-white max-w-sm"><button id="checkAllScopeBtn"class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-2">項目を全てチェック</button><form id="confirmForm"method="post"action="/error"><div id="requiredPermissionList"></div><ul class="accordion w-full rounded-lg shadow-lg shadow-gray-100 p-2 mb-2"><li id="showOptionPermissionBtn"class="my-1"><span class="font-bold text-xl tracking-tight text-gray-500 flex flex-row justify-between items-center cursor-pointer p-2"><p>必須ではない権限の一覧</p><svg class="text-gray-500 mr-1"xmlns="http://www.w3.org/2000/svg"width="16"height="16"fill="currentColor"class="bi bi-arrow-down-short"viewBox="0 0 16 16"><path fill-rule="evenodd"d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"clip-rule="evenodd"></path></svg></span><div id="notRequiredPermissionList"class="text-gray-500 text-md p-2 cursor-default"></div></ul><button type="submit"class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Confirm</button></form></div></div></div><img id="loading"class="fixed -translate-x-1/2 -translate-y-1/2 inset-1/2 transform hidden"src="/img/loading.svg"><div id="modalBackground"data-id="modalClose"class="fixed bg-white bg-opacity-50 w-full h-full z-40 inset-0 hidden"></div><div id="modalTemplate"data-id="modal"class="transition-opacity duration-500 fixed w-11/12 lg:w-5/12 h-full left-0 right-0 m-auto flex font-extrabold z-50 hidden"><div data-id="modalCard"class="card relative m-auto w-4/5 shadow-lg rounded-2xl"><div class="p-4 bg-gray-200 text-black rounded-t-2xl"><span data-id="modalClose"class="float-right text-lg font-bold hover:text-gray-500 no-underline cursor-pointer">&times;</span><h2 data-id="modalTitle">Modal Title</h2></div><div data-id="modalContent"class="p-8 bg-gray-100"></div><div class="p-2 text-white bg-gray-200 flex justify-end rounded-b-2xl"><button data-id="modalCancelButton"class="bg-gray-800 hover:underline font-extrabold rounded py-4 px-8 shadow">キャンセル</button> <button data-id="modalConfirmButton"class="bg-green-400 hover:underline font-extrabold rounded py-4 px-8 ml-2 shadow">確認</button></div></div></div><div id="hiddenForTailwindByJs"class="hidden w-full h-96 p-1"></div><div id="permissionCheckTemplate"class="hidden form-group form-check mb-4 p-1 rounded-md flex items-center"><input data-id="permissionCheckTemplateInput"type="checkbox"class="form-check-input h-4 w-4 border border-gray-300 rounded-sm bg-white checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition duration-200 mt-1 align-top bg-no-repeat bg-center bg-contain float-left mr-2 cursor-pointer"> <label data-id="permissionCheckTemplateInputLabel"for="permissionCheckTemplateInput"class="form-check-label inline-block w-full"></label> <button data-id="permissionCheckTemplateDetailBtn"class="bg-gray-100 hover:bg-gray-300 text-gray-500 font-bold px-2 rounded-full">?</button></div><div id="permissionCheckBlackTemplate"class="hidden form-group form-check mb-4 p-1 rounded-md flex items-center bg-black text-white"><input data-id="permissionCheckTemplateInput"type="checkbox"class="form-check-input h-4 w-4 border border-gray-300 rounded-sm bg-white checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition duration-200 mt-1 align-top bg-no-repeat bg-center bg-contain float-left mr-2 cursor-pointer"> <label data-id="permissionCheckTemplateInputLabel"for="permissionCheckTemplateInput"class="form-check-label inline-block w-full"></label> <button data-id="permissionCheckTemplateDetailBtn"class="bg-gray-100 hover:bg-gray-300 text-gray-500 font-bold px-2 rounded-full">?</button></div><a id="permissionCheckDetailButtonTemplate"href="#"target="_blank"class="hidden px-2 py-1 rounded text-white no-underline bg-blue-500 hover:bg-blue-700">詳細 &gt;</a><script>(()=>{var __defProp=Object.defineProperty,__export=(target,all)=>{for(var name in(target=>__defProp(target,"__esModule",{value:!0}))(target),all)__defProp(target,name,{get:all[name],enumerable:!0})},setting_exports={},browserServerSetting_exports=(__export(setting_exports,{bsc:()=>bsc,get:()=>get2,getBrowserServerSetting:()=>getBrowserServerSetting,scopeExtraConfigList:()=>scopeExtraConfigList,userHmacSecret:()=>userHmacSecret}),{}),apiEndpoint=(__export(browserServerSetting_exports,{apiEndpoint:()=>apiEndpoint,default:()=>browserServerSetting_default,get:()=>get,labelList:()=>labelList,statusList:()=>statusList,userReadableDateFormat:()=>userReadableDateFormat}),"/f"),labelList={scopeBody:{global:{notification:{label:"すべての通知",summary:"すべてのサービスの通知に関する権限です。ログイン時刻などを含みます。"}},auth:{emailAddress:{label:"メールアドレス",summary:"ログインに使用するメールアドレスに関する権限です。バックアップメールアドレスは含みません。"},backupEmailAddress:{label:"バックアップメールアドレス",summary:"バックアップメールアドレスに関する権限です。ログインに使用するメールアドレスは含みません。"},userName:{label:"ユーザー名",summary:"一般公開されているユーザーの名前です。"}},service:{serviceUserId:{label:"ユーザーID",summary:"連携するサービスに提供する、あなたのアカウントのIDです。サービス毎に異なります。"},notification:{label:"サービス内通知",summary:"連携するサービス内で、通知機能を利用するための権限です。"},file:{label:"ファイル",summary:"連携するサービスで、あなたがデータを保存できます。"}}},scopeOperation:{operation:{read:"取得",write:"保存",append:"追記"},prefix:{isRequired:"必須"}},error:{undefined:"error",handle_credential_credential:"メールアドレスまたはパスワードが違います。",handle_user_add_register:"メールアドレスは既に登録されています。",handle_xlogin_code_session:"セッションが不正です。"}},statusList={OK:1,SUCCESS:100,LOGIN_SUCCESS:101,INVALID:1e3,NOT_ENOUGH_PARAM:1001,INVALID_SESSION:1002,API_ERROR:1100,INVALID_OIDC_ISSUER:1101,NOT_FOUND:1200},userReadableDateFormat={full:"YYYY/MM/DD hh:mm:ss",day:"YYYY/MM/DD",hourMinute:"hh:mm",time:"hh:mm:ss"},settingList={apiEndpoint:apiEndpoint,labelList:labelList,statusList:statusList,userReadableDateFormat:userReadableDateFormat},get=(...keyList)=>{var constantList=keyList.reduce((prev,curr)=>(prev[curr]=settingList[curr],prev),{});for(const key of keyList)if(!constantList[key])throw new Error("[error] undefined setting constant: "+key);return constantList},browserServerSetting_default=settingList,userHmacSecret="xlogin20220630",scopeExtraConfigList={"auth:backupEmailAddress":{templateId:"#permissionCheckBlackTemplate",dialogConfirm:!0}},bsc=browserServerSetting_exports,settingList2={userHmacSecret:userHmacSecret,scopeExtraConfigList:scopeExtraConfigList},getBrowserServerSetting=()=>browserServerSetting_exports,get2=(...keyList)=>{var constantList=keyList.reduce((prev,curr)=>(prev[curr]=settingList2[curr],prev),{});for(const key of keyList)if(!constantList[key])throw new Error("[error] undefined setting constant: "+key);return constantList},lib_exports={},getCaller=(__export(lib_exports,{buf2Hex:()=>buf2Hex,calcHmac512:()=>calcHmac512,calcPbkdf2:()=>calcPbkdf2,genSalt:()=>genSalt,getCaller:()=>getCaller,getErrorModalElmAndSetter:()=>getErrorModalElmAndSetter,getModalElmAndSetter:()=>getModalElmAndSetter,getRandomStr:()=>getRandomStr,getRequest:()=>getRequest,getSearchQuery:()=>getSearchQuery,monkeyPatch:()=>monkeyPatch,postRequest:()=>postRequest,redirect:()=>redirect,setOnClickNavManu:()=>setOnClickNavManu,setOnClickNotification:()=>setOnClickNotification,showGlobalNotification:()=>showGlobalNotification,showModal:()=>showModal,slideDown:()=>slideDown,slideToggle:()=>slideToggle,slideUp:()=>slideUp,switchLoading:()=>switchLoading}),()=>{return(new Error).stack.replace(/^Error\n.*\n.*\n/,"")}),getRequest=(_url,param={})=>{var query=param&&Object.keys(param).map(key=>key+"="+param[key]).join("&");return fetch(query?_url+"?"+query:_url,{method:"GET",credentials:"same-origin",timeout:3e4}).then(res=>!res.error&&res.body&&res.json?res.json():null).catch(e=>(console.error("[fatal] error @getRequest:",e),null))},postRequest=(url,param={})=>{var opt={method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},timeout:3e4};return param&&(opt.body=JSON.stringify(param)),fetch(url,opt).then(res=>!res.error&&res.body&&res.json?res.json():null).catch(e=>(console.error("[fatal] error @postRequest:",e),null))},applyElmList=(query,f,parent=document)=>{Object.values(parent.querySelectorAll(query)).forEach(elm=>{f(elm)})},closeModal=()=>{applyElmList('[data-id="modal"], #modalBackground',elm=>{elm.classList.add("hidden")})},showModal=(modalElm,cancelButtonIsVisible=!1)=>new Promise(resolve=>{"modalTemplate"===modalElm.id&&(modalElm.id=""),document.body.appendChild(modalElm),closeModal(),setTimeout(()=>{applyElmList('[data-id="modalClose"], [data-id="modalCancelButton"]',elm=>{elm.onclick=()=>(closeModal(),resolve(!1))},document),cancelButtonIsVisible?modalElm.querySelector('[data-id="modalCancelButton"]').classList.remove("hidden"):modalElm.querySelector('[data-id="modalCancelButton"]').classList.add("hidden"),modalElm.querySelector('[data-id="modalConfirmButton"]').onclick=()=>(closeModal(),resolve(!0)),modalElm.classList.remove("hidden"),document.querySelector("#modalBackground").classList.remove("hidden"),modalElm.querySelector('[data-id="modalContent"]').scrollTop=0,modalElm.querySelector('[data-id="modalCard"]').onclick=e=>{e.stopPropagation()},modalElm.onclick=e=>(e.stopPropagation(),closeModal(),resolve(!1))},100)}),getErrorModalElmAndSetter=()=>{var modalElm=document.querySelector("#modalTemplate").cloneNode(!0);const modalTitleElm=modalElm.querySelector('[data-id="modalTitle"]'),labelP=(modalTitleElm.innerText="エラー",document.createElement("p"));labelP.innerText="エラーが発生しました。",modalElm.querySelector('[data-id="modalContent"]').appendChild(labelP);return{modalElm:modalElm,setContent:(textStr,errorLabelList=null,title="エラー")=>{labelP.innerText=errorLabelList&&errorLabelList[textStr]||textStr,modalTitleElm.innerText=title}}},getModalElmAndSetter=()=>{var modalElm=document.querySelector("#modalTemplate").cloneNode(!0);const modalTitleElm=modalElm.querySelector('[data-id="modalTitle"]'),modalContentElm=modalElm.querySelector('[data-id="modalContent"]');return{modalElm:modalElm,setContentElm:(title,contentElm)=>{modalTitleElm.innerText=title,modalContentElm.clearChildren(),modalContentElm.appendChild(contentElm)}}},switchLoading=isVisible=>{var loadingElm=document.querySelector("#loading");loadingElm&&(isVisible?loadingElm.classList.remove("hidden"):loadingElm.classList.add("hidden"))},setOnClickNavManu=()=>{var toggleElm=document.querySelector("#commonNavToggle");const navContentElm=document.querySelector("#commonNavContent");toggleElm.onclick=()=>{0<=[...navContentElm.classList.values()].indexOf("hidden")?navContentElm.classList.remove("hidden"):navContentElm.classList.add("hidden")}},notificationIsVisible=!1,showGlobalNotification=async apiEndpoint2=>{apiEndpoint2=await getRequest(apiEndpoint2+"/notification/global/list");const notificationContainerElm=document.querySelector("#notificationContainer"),notificationTemplateElm=(notificationContainerElm.clearChildren(),document.querySelector("#notificationTemplate")),notificationList=Object.values(apiEndpoint2?.result?.globalNotificationList||{}).reverse();notificationList.forEach((row,i)=>{const notificationElm=notificationTemplateElm.cloneNode(!0);notificationElm.classList.remove("hidden"),notificationElm.querySelector('[data-id="subject"]').innerText=row.subject,notificationElm.onclick=e=>{e.preventDefault(),e.stopPropagation();e=document.querySelector("#modalTemplate").cloneNode(!0);e.classList.remove("hidden"),e.querySelector('[data-id="modalTitle"]').innerText=row.subject,e.querySelector('[data-id="modalContent"]').appendChild(document.createTextNode(row.detail)),showModal(e)},setTimeout(()=>{notificationElm.style.transitionDuration="0.5s",notificationElm.style.opacity=0,notificationContainerElm.appendChild(notificationElm),setTimeout(()=>{notificationElm.style.opacity=1},100)},.5*i*1e3),setTimeout(()=>{notificationElm.style.transitionDuration="0.2s",notificationElm.style.opacity=0},.5*notificationList.length*1e3+3e3+.2*i*1e3)}),setTimeout(()=>{notificationContainerElm.clearChildren(),notificationIsVisible=!1},.7*notificationList.length*1e3+3e3)},setOnClickNotification=apiEndpoint2=>{applyElmList('[data-id="notificationBtn"]',notificationBtn=>{notificationBtn.onclick=e=>{e.preventDefault(),e.stopPropagation(),notificationIsVisible||(notificationIsVisible=!0,showGlobalNotification(apiEndpoint2))}})},monkeyPatch=()=>{void 0===Element.prototype.clearChildren&&Object.defineProperty(Element.prototype,"clearChildren",{configurable:!0,enumerable:!1,value(){for(;this.firstChild;)this.removeChild(this.lastChild)}}),void 0===window.argNamed&&(window.argNamed=obj=>{const flattened={};return Object.keys(obj).forEach(key=>{Array.isArray(obj[key])?Object.assign(flattened,obj[key].reduce((prev,curr)=>{if(void 0===curr)throw new Error(`[error] flat argument by list can only contain function but: ${typeof curr} @${key}
===== maybe you need make func exported like  module.exports = { func, } =====`);if("function"!=typeof curr)throw new Error(`[error] flat argument by list can only contain function but: ${typeof curr} @`+key);return prev[curr.name]=curr,prev},{})):"object"==typeof obj[key]&&null!==obj[key]?Object.assign(flattened,obj[key]):flattened[key]=obj[key]}),flattened})},getRandomStr=len=>btoa(crypto.getRandomValues(new Uint8Array(len))).slice(0,len),buf2Hex=buf=>Array.prototype.map.call(new Uint8Array(buf),x=>("00"+x.toString(16)).slice(-2)).join(""),calcHmac512=(data,secret)=>new Promise(resolve=>{const enc=new TextEncoder("utf-8");window.crypto.subtle.importKey("raw",enc.encode(secret),{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign","verify"]).then(key=>{window.crypto.subtle.sign("HMAC",key,enc.encode(data)).then(hash=>{hash=new Uint8Array(hash);resolve(buf2Hex(hash))})})}),genSalt=()=>window.crypto.getRandomValues(new Uint8Array(64)),calcPbkdf2=(str,salt)=>new Promise(resolve=>{var byteList=new Uint8Array(Array.prototype.map.call(str,c=>c.charCodeAt(0)));window.crypto.subtle.importKey("raw",byteList,{name:"PBKDF2"},!1,["deriveBits"]).then(key=>{return window.crypto.subtle.deriveBits({name:"PBKDF2",salt:salt,iterations:1e6,hash:{name:"SHA-512"}},key,512).then(buf=>{resolve(buf2Hex(buf))})})}),redirect=response=>{response&&response.redirect&&(window.location.href=response.redirect)},getSearchQuery=()=>{const searchQuery={};return window.location.search.replace(/^\?/,"").split("&").forEach(row=>{var[row,value]=row.split("=");searchQuery[row]=value}),searchQuery},slideUp=(elm,duration=300)=>{elm.style.height=elm.offsetHeight+"px",null!==elm.offsetHeight&&(elm.style.transitionProperty="height, margin, padding",elm.style.transitionDuration=duration+"ms",elm.style.transitionTimingFunction="ease",elm.style.overflow="hidden",elm.style.height=0,elm.style.paddingTop=0,elm.style.paddingBottom=0,elm.style.marginTop=0,elm.style.marginBottom=0,setTimeout(()=>{elm.style.display="none",elm.style.removeProperty("height"),elm.style.removeProperty("padding-top"),elm.style.removeProperty("padding-bottom"),elm.style.removeProperty("margin-top"),elm.style.removeProperty("margin-bottom"),elm.style.removeProperty("overflow"),elm.style.removeProperty("transition-duration"),elm.style.removeProperty("transition-property"),elm.style.removeProperty("transition-timing-function")},duration))},slideDown=(elm,duration=300)=>{elm.style.removeProperty("display");let display=window.getComputedStyle(elm)["display"];"none"===display&&(display="block"),elm.style.display=display;var height=elm.offsetHeight;elm.style.overflow="hidden",elm.style.height=0,elm.style.paddingTop=0,elm.style.paddingBottom=0,elm.style.marginTop=0,elm.style.marginBottom=0,null!==elm.offsetHeight&&(elm.style.transitionProperty="height, margin, padding",elm.style.transitionDuration=duration+"ms",elm.style.transitionTimingFunction="ease",elm.style.height=height+"px",elm.style.removeProperty("padding-top"),elm.style.removeProperty("padding-bottom"),elm.style.removeProperty("margin-top"),elm.style.removeProperty("margin-bottom"),setTimeout(()=>{elm.style.removeProperty("height"),elm.style.removeProperty("overflow"),elm.style.removeProperty("transition-duration"),elm.style.removeProperty("transition-property"),elm.style.removeProperty("transition-timing-function")},duration))},slideToggle=(elm,duration=300,ignoreIfOpen=!1)=>{"none"===window.getComputedStyle(elm).display?slideDown(elm,duration):ignoreIfOpen||slideUp(elm,duration)},input_exports={},fetchScope=(__export(input_exports,{default:()=>input_default,fetchScope:()=>fetchScope}),({getRequest:getRequest2,apiEndpoint:apiEndpoint2})=>{return getRequest2(apiEndpoint2+"/confirm/scope/list")}),input_default={},action_exports={},getOnSubmitConfirm=(__export(action_exports,{default:()=>action_default,getOnClickCheckAllScopeButton:()=>getOnClickCheckAllScopeButton,getOnClickScopeDetailBtn:()=>getOnClickScopeDetailBtn,getOnClickShowOptionPermissionBtn:()=>getOnClickShowOptionPermissionBtn,getOnSubmitConfirm:()=>getOnSubmitConfirm}),({getPermissionCheckList:getPermissionCheckList2,postConfirm,switchLoading:switchLoading2,redirect:redirect2,checkImportantPermissionWithModal:checkImportantPermissionWithModal2,scopeExtraConfigList:scopeExtraConfigList2,labelList:labelList2,showModal:showModal2,getErrorModalElmAndSetter:getErrorModalElmAndSetter2,resultCheckTrough})=>async()=>{switchLoading2(!0);var permissionList=getPermissionCheckList2();await checkImportantPermissionWithModal2({permissionList:permissionList,resultCheckTrough:resultCheckTrough,scopeExtraConfigList:scopeExtraConfigList2,labelList:labelList2,showModal:showModal2,getErrorModalElmAndSetter:getErrorModalElmAndSetter2})?postConfirm({permissionList:permissionList}).then(result=>{switchLoading2(!1),redirect2(result)}):switchLoading2(!1)}),getOnClickCheckAllScopeButton=({getRequiredPermissionCheckElmList:getRequiredPermissionCheckElmList2})=>()=>{setTimeout(()=>{getRequiredPermissionCheckElmList2().forEach(elm=>{elm.checked=!0})},300)},getOnClickShowOptionPermissionBtn=({notRequiredPermissionListElm,flipSvgElm,slideToggle:slideToggle2})=>()=>{slideToggle2(notRequiredPermissionListElm,300,!1),flipSvgElm.classList.contains("flipY")?flipSvgElm.classList.remove("flipY"):flipSvgElm.classList.add("flipY")},getOnClickScopeDetailBtn=({getModalElmAndSetter:getModalElmAndSetter2,showModal:showModal2})=>{const{modalElm,setContentElm}=getModalElmAndSetter2();return(modalTitle,contentElm)=>{setContentElm(modalTitle,contentElm),showModal2(modalElm)}},action_default={},core_exports={},_convertScopeToLabel=(__export(core_exports,{checkImportantPermissionWithModal:()=>checkImportantPermissionWithModal,checkThrough:()=>checkThrough,convertPermissionList:()=>convertPermissionList}),({labelList:labelList2,scope})=>{var paramList=scope.split(":");if(paramList.length<2)throw new Error("invalid scope value: "+scope);let isRequired=null;scope=[];if("*"===paramList[0][0]?(isRequired=!0,paramList[0]=paramList[0].slice(1)):isRequired=!1,0<=paramList[0].indexOf("r")&&scope.push("read"),0<=paramList[0].indexOf("w")&&scope.push("write"),0<=paramList[0].indexOf("a")&&scope.push("append"),0===scope.length)throw new Error("unknown mode: "+paramList[0]);"auth"!==paramList[1]&&(paramList[1]="service");var scope=scope.map(mode=>labelList2.scopeOperation.operation[mode]).join("と"),{label:paramList,summary}=labelList2.scopeBody[paramList[1]][paramList[2]],labelNoWrapList=[],paramList=(labelNoWrapList.push(paramList),isRequired?labelNoWrapList.push(`の${scope} (${labelList2.scopeOperation.prefix.isRequired})`):labelNoWrapList.push("の"+scope),labelNoWrapList.join(""));return{labelNoWrapList:labelNoWrapList,label:paramList,summary:summary,isRequired:isRequired}}),convertPermissionList=({labelList:labelList2,resultFetchScope})=>{if(!resultFetchScope||!resultFetchScope.result||!resultFetchScope.result.scope)throw new Error("invalid scope value: "+JSON.stringify(resultFetchScope));const permissionLabelList={};resultFetchScope=resultFetchScope.result.scope.split(",");return 0!==resultFetchScope.length&&resultFetchScope.forEach(scope=>{permissionLabelList[scope]=_convertScopeToLabel({scope:scope,labelList:labelList2})}),permissionLabelList},checkThrough=({postThrough,notRequiredPermissionListElm,flipSvgElm,updateRequestScope:updateRequestScope2,updateScopeAlreadyChecked:updateScopeAlreadyChecked2,switchLoading:switchLoading2,redirect:redirect2,slideToggle:slideToggle2})=>(switchLoading2(!0),postThrough().then(result=>{switchLoading2(!1),redirect2(result),updateRequestScope2({requestScope:result?.result?.requestScope,notRequiredPermissionListElm:notRequiredPermissionListElm,flipSvgElm:flipSvgElm,slideToggle:slideToggle2});var oldPermissionList=result?.result?.oldPermissionList||{};return updateScopeAlreadyChecked2({oldPermissionList:oldPermissionList}),result})),checkImportantPermissionWithModal=async({permissionList,resultCheckTrough,scopeExtraConfigList:scopeExtraConfigList2,labelList:labelList2,showModal:showModal2,getErrorModalElmAndSetter:getErrorModalElmAndSetter2})=>{var scope,isChecked,{modalElm,setContent}=getErrorModalElmAndSetter2(),oldPermissionList=resultCheckTrough?.result?.oldPermissionList||{};for await([scope,isChecked]of Object.entries(permissionList))if(isChecked&&!oldPermissionList[scope]){var scopeWithoutOperation=scope.split(":").slice(1).join(":");if(scopeExtraConfigList2[scopeWithoutOperation]&&scopeExtraConfigList2[scopeWithoutOperation].dialogConfirm){scopeWithoutOperation=_convertScopeToLabel({labelList:labelList2,scope:scope})["label"],scopeWithoutOperation=(setContent(`[${scopeWithoutOperation}(${scope})]は重要な権限です。本当に許可しますか？`,null,"確認"),await showModal2(modalElm,!0));if(!scopeWithoutOperation)return!1}}return!0},output_exports={},showPermissionLabelList=(__export(output_exports,{getAccordionElm:()=>getAccordionElm,getConfirmFormElm:()=>getConfirmFormElm,getPermissionCheckList:()=>getPermissionCheckList,getPostConfirm:()=>getPostConfirm,getPostThrough:()=>getPostThrough,getRequiredPermissionCheckElmList:()=>getRequiredPermissionCheckElmList,setConfirmFormSubmit:()=>setConfirmFormSubmit,setOnCheckAllScopeButton:()=>setOnCheckAllScopeButton,setOnClickShowOptionPermissionBtn:()=>setOnClickShowOptionPermissionBtn,showPermissionLabelList:()=>showPermissionLabelList,updateRequestScope:()=>updateRequestScope,updateScopeAlreadyChecked:()=>updateScopeAlreadyChecked}),({permissionLabelList,getRandomStr:getRandomStr2,scopeExtraConfigList:scopeExtraConfigList2,onClickScopeDetailBtn})=>{const requiredPermissionListElm=document.querySelector("#requiredPermissionList"),notRequiredPermissionListElm=document.querySelector("#notRequiredPermissionList"),permissionCheckDetailButtonTemplateElm=document.querySelector("#permissionCheckDetailButtonTemplate");Object.entries(permissionLabelList).forEach(([scope,permission])=>{var inputElmId="permissionCheck_"+getRandomStr2(16),wrapElmId="wrap_"+inputElmId;const scopeWithoutOperation=scope.split(":").slice(1).join(":");var scopeExtraConfig=scopeExtraConfigList2[scopeWithoutOperation];let permissionCheckElm=null;(permissionCheckElm=(scopeExtraConfig&&scopeExtraConfig.templateId?document.querySelector(scopeExtraConfig.templateId):document.querySelector("#permissionCheckTemplate")).cloneNode(!0)).classList.remove("hidden"),permissionCheckElm.setAttribute("id",wrapElmId);scopeExtraConfig=permissionCheckElm.querySelector('[data-id="permissionCheckTemplateInput"]');scopeExtraConfig.setAttribute("data-scope",scope),scopeExtraConfig.setAttribute("id",inputElmId),scopeExtraConfig.setAttribute("data-scope-is-required",permission.isRequired),permission.isRequired&&scopeExtraConfig.setAttribute("required",!0);const labelElm=permissionCheckElm.querySelector('[data-id="permissionCheckTemplateInputLabel"]');labelElm.setAttribute("for",inputElmId),permission.labelNoWrapList.forEach(label=>{var noWrapElm=document.createElement("span");noWrapElm.classList.add("whitespace-nowrap"),noWrapElm.innerText=label,labelElm.appendChild(noWrapElm)}),permissionCheckElm.querySelector('[data-id="permissionCheckTemplateDetailBtn"]').onclick=e=>{e.preventDefault();var e=document.createElement("div"),summaryLinkElm=(e.appendChild(document.createTextNode(permission.summary)),permissionCheckDetailButtonTemplateElm.cloneNode(!0));summaryLinkElm.setAttribute("href","/scopeDetail#"+scopeWithoutOperation),summaryLinkElm.classList.remove("hidden"),e.appendChild(summaryLinkElm),onClickScopeDetailBtn("権限の説明",e)},permission.isRequired?requiredPermissionListElm.insertBefore(permissionCheckElm,requiredPermissionListElm.children[requiredPermissionListElm.children.length-1]):notRequiredPermissionListElm.insertBefore(permissionCheckElm,notRequiredPermissionListElm.children[notRequiredPermissionListElm.children.length-1])})}),updateRequestScope=({requestScope,notRequiredPermissionListElm,flipSvgElm,slideToggle:slideToggle2})=>{requestScope=document.querySelector(`[data-scope="${requestScope}"]`);requestScope&&(requestScope.parentNode.classList.add("bg-red-400"),slideToggle2(notRequiredPermissionListElm,300,!0),flipSvgElm.classList.contains("flipY")||flipSvgElm.classList.add("flipY"))},updateScopeAlreadyChecked=({oldPermissionList})=>{Object.values(document.querySelectorAll("[data-scope]")).forEach(elm=>{let scope=elm.dataset["scope"];0<scope.length&&"*"===scope[0]&&(scope=scope.slice(1)),oldPermissionList[scope]&&(elm.checked=!0)})},getPermissionCheckList=()=>{const permissionCheckList={};return Object.values(document.querySelectorAll("[data-scope]")).forEach(elm=>{let scope=elm.dataset["scope"];0<scope.length&&"*"===scope[0]&&(scope=scope.slice(1)),permissionCheckList[scope]=elm.checked}),permissionCheckList},getPostConfirm=({apiEndpoint:apiEndpoint2,postRequest:postRequest2})=>{const url=apiEndpoint2+"/confirm/permission/check";return({permissionList})=>{permissionList={permissionList:permissionList};return postRequest2(url,permissionList)}},getConfirmFormElm=()=>{return document.querySelector("#confirmForm")},setConfirmFormSubmit=({confirmFormElm,onSubmitConfirm})=>{confirmFormElm.onsubmit=e=>{e.preventDefault(),e.stopPropagation(),onSubmitConfirm()}},getPostThrough=({apiEndpoint:apiEndpoint2,postRequest:postRequest2})=>{const url=apiEndpoint2+"/confirm/through/check";return()=>{return postRequest2(url,{})}},getRequiredPermissionCheckElmList=()=>{return Object.values(document.querySelectorAll('[data-scope-is-required="true"]'))},setOnCheckAllScopeButton=({onClickCheckAllScopeButton})=>{document.querySelector("#checkAllScopeBtn").onclick=onClickCheckAllScopeButton},getAccordionElm=()=>{return{notRequiredPermissionListElm:document.querySelector("#notRequiredPermissionList"),flipSvgElm:document.querySelector("#showOptionPermissionBtn svg"),showOptionPermissionBtnElm:document.querySelector("#showOptionPermissionBtn")}},setOnClickShowOptionPermissionBtn=({showOptionPermissionBtnElm,onClickShowOptionPermissionBtn,notRequiredPermissionListElm})=>{showOptionPermissionBtnElm.onclick=onClickShowOptionPermissionBtn,notRequiredPermissionListElm.onclick=e=>{e.stopPropagation()}},__export={},a=(__export.setting=setting_exports,__export.lib=lib_exports,__export.input=input_exports,__export.action=action_exports,__export.core=core_exports,__export.output=output_exports,__export);a.app={main:async()=>{a.lib.switchLoading(!0),a.lib.setOnClickNavManu(),a.lib.setOnClickNotification(a.setting.bsc.apiEndpoint),a.lib.monkeyPatch(),await a.app.loadAllPermissionList(),a.app.loadCheckAllScopeButton(),await a.app.loadNotRequiredPermissionListAccordion();var resultCheckTrough=await a.app.startThroughCheck();a.app.loadConfirmForm({resultCheckTrough:resultCheckTrough})},loadAllPermissionList:async()=>{var resultFetchScope=await a.input.fetchScope(argNamed({setting:a.setting.bsc.get("apiEndpoint"),lib:[a.lib.getRequest]})),resultFetchScope=a.core.convertPermissionList(argNamed({setting:a.setting.bsc.get("labelList"),other:{resultFetchScope:resultFetchScope}})),onClickScopeDetailBtn=a.action.getOnClickScopeDetailBtn(argNamed({lib:[a.lib.showModal,a.lib.getModalElmAndSetter]}));a.output.showPermissionLabelList(argNamed({setting:a.setting.get("scopeExtraConfigList"),setting2:a.setting.bsc.get("labelList"),lib:[a.lib.getRandomStr],other:{permissionLabelList:resultFetchScope,onClickScopeDetailBtn:onClickScopeDetailBtn}}))},loadConfirmForm:({resultCheckTrough})=>{var postConfirm=a.output.getPostConfirm(argNamed({lib:[a.lib.postRequest],setting:a.setting.bsc.get("apiEndpoint")})),postConfirm=a.action.getOnSubmitConfirm(argNamed({output:[a.output.getPermissionCheckList],core:[a.core.checkImportantPermissionWithModal],setting:a.setting.get("scopeExtraConfigList"),setting2:a.setting.bsc.get("labelList"),lib:[a.lib.switchLoading,a.lib.redirect,a.lib.showModal,a.lib.getErrorModalElmAndSetter],other:{postConfirm:postConfirm,resultCheckTrough:resultCheckTrough}})),resultCheckTrough=a.output.getConfirmFormElm();a.output.setConfirmFormSubmit(argNamed({elm:{confirmFormElm:resultCheckTrough},onSubmit:{onSubmitConfirm:postConfirm}}))},loadCheckAllScopeButton:()=>{var onClickCheckAllScopeButton=a.action.getOnClickCheckAllScopeButton(argNamed({output:[a.output.getRequiredPermissionCheckElmList]}));a.output.setOnCheckAllScopeButton(argNamed({onClick:{onClickCheckAllScopeButton:onClickCheckAllScopeButton}}))},loadNotRequiredPermissionListAccordion:async()=>{var{notRequiredPermissionListElm,flipSvgElm,showOptionPermissionBtnElm}=a.output.getAccordionElm(),flipSvgElm=a.action.getOnClickShowOptionPermissionBtn(argNamed({elm:{notRequiredPermissionListElm:notRequiredPermissionListElm,flipSvgElm:flipSvgElm},lib:[a.lib.slideToggle]}));a.output.setOnClickShowOptionPermissionBtn(argNamed({elm:{notRequiredPermissionListElm:notRequiredPermissionListElm,showOptionPermissionBtnElm:showOptionPermissionBtnElm},onClick:{onClickShowOptionPermissionBtn:flipSvgElm}}))},startThroughCheck:async()=>{var postThrough=a.output.getPostThrough(argNamed({lib:[a.lib.postRequest],setting:a.setting.bsc.get("apiEndpoint")})),{notRequiredPermissionListElm,flipSvgElm}=a.output.getAccordionElm();return a.core.checkThrough(argNamed({param:{postThrough:postThrough,notRequiredPermissionListElm:notRequiredPermissionListElm,flipSvgElm:flipSvgElm},output:[a.output.updateRequestScope,a.output.updateScopeAlreadyChecked],lib:[a.lib.switchLoading,a.lib.redirect,a.lib.slideToggle]}))}},a.app.main()})();</script>